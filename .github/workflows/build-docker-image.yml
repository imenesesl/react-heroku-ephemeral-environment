name: "Build Docker Image"
on:
  workflow_call:
    inputs:
      repository_owner:
        required: true
        type: string
      repository_name:
        required: true
        type: string
      environment_name:
        required: true
        type: string
      pr_number:
        required: true
        type: string

jobs:
  build-docker-image:
    runs-on: ubuntu-latest
    outputs:
      image_tag: ${{ env.IMAGE_TAG }}
      app_name: ${{ env.APP_NAME }}
    steps:
      - uses: actions/checkout@v2
        with:
          repository: "imenesesl/heroku-ephemeral-environment"
          path: "docker"
      - name: ðŸ”’ Creating IMAGE_TAG
        run: |
          IMAGE_TAG="${{ inputs.repository_owner }}/${{ inputs.repository_name }}:${{ github.sha }}"
          echo "IMAGE_TAG=$IMAGE_TAG" >> $GITHUB_ENV
          docker build -t $IMAGE_TAG ./docker
      - name: ðŸ”’ Creating APP_NAME
        run: |
          APP_NAME="${{inputs.environment_name}}-pr-${{ inputs.pr_number }}"
          echo "APP_NAME=$APP_NAME" >> $GITHUB_ENV
